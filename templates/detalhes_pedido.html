{% extends 'base.html' %}
{% block title %}{{ titulo }}{% endblock %}

{% block content %}
    <h1>Detalhes do Pedido #{{ pedido.id }}</h1>
    <p><strong>Data da Compra:</strong> {{ pedido.data_criacao }}</p>
    <p><strong>Data da Expedição:</strong> {{ pedido.data_envio_solicitada|date:"d/m/Y" }}</p>
    <p><strong>Situação do Pedido</strong>: {{ pedido.status }}</p>
    <p><strong>Opção de Frete:</strong> {{ pedido.get_frete_option_display }}</p>
    <p><strong>Opção de Nota Fiscal:</strong> {{ pedido.get_nota_fiscal_display }}</p>

    <hr>
    <div class="card mb-4">
        <div class="card-header">
            <h3>Endereço de Envio</h3>
        </div>
        <div class="card-body">
            <p>{{ pedido.endereco.logradouro }}, {{ pedido.endereco.bairro }}, {{ pedido.endereco.numero }} {{ pedido.endereco.cidade }} - {{ pedido.endereco.estado }} (CEP: {{ pedido.endereco.cep }})</p>
        </div>
    </div>
    <hr>
    
    <h2>Itens do Pedido</h2>
    <table class="table table-striped">
        <thead>
            <tr>
                <th>Código</th>
                <th>Descrição</th>
                {% if preco_exibido == 'sp' %}
                    <th>Valor (SP)</th>
                {% elif preco_exibido == 'es' %}
                    <th>Valor (ES)</th>
                {% elif preco_exibido == 'todos' %}
                    <th>Valor (SP)</th>
                    <th>Valor (ES)</th>
                {% endif %}
                <th>Quantidade</th>
                <th>Subtotal</th>
            </tr>
        </thead>
        <tbody>
            {% for item_detalhe in itens_detalhes %}
            <tr>
                <td>{{ item_detalhe.item.produto.product_code }}</td>
                <td>{{ item_detalhe.item.produto.product_description }}</td>
                {% if preco_exibido == 'todos' %}
                    <td>R$ {{ item_detalhe.item.produto.product_value_sp|floatformat:2 }}</td>
                    <td>R$ {{ item_detalhe.item.produto.product_value_es|floatformat:2 }}</td>
                {% else %}
                    <td>R$ {{ item_detalhe.valor_unitario|floatformat:2 }}</td>
                {% endif %}
                <td>{{ item_detalhe.item.quantidade }}</td>
                <td>R$ {{ item_detalhe.valor_total|floatformat:2 }}</td>
            </tr>
            {% endfor %}
        </tbody>
        <tfoot>
            <tr>
                {% if preco_exibido == 'todos' %}
                    <td colspan="5" class="text-end"><strong>Total Geral:</strong></td>
                {% else %}
                    <td colspan="4" class="text-end"><strong>Total Geral:</strong></td>
                {% endif %}
                <td><strong>R$ {{ total_geral|floatformat:2 }}</strong></td>
            </tr>
        </tfoot>
    </table>
   <div class="mt-4 mb-4 d-flex">
            {% if user.is_staff %}
                <a href="{% url 'dashboard_admin' %}" class="btn btn-secondary">Voltar para o Dashboard</a>
                <a href="{% url 'exportar_detalhes_pedido_admin_excel' pedido.id %}" class="btn btn-primary ms-2">Exportar para Excel (Admin)</a>
                <a target="_blank" class="btn btn-success ms-2" href="https://wa.me/5516991273974?text=*Dados%20do%20Pedido*%0A%0A*Codigo%20Interno:*%20{{ pedido.id }}%0A*Código%20do%20Cliente:*%20{{ pedido.cliente.client_code }}%0A*Razão%20Social:*%20{{ pedido.cliente.client_name }}%0A*Data%20da%20Expedição:*%20{{ pedido.data_envio_solicitada|date:"d/m/Y" }}%0A*Opção%20de%20Frete:*%20{{ pedido.get_frete_option_display }}%0A*Endereço%20de%20Entrega:*%20{{ pedido.endereco.logradouro }},%20{{ pedido.endereco.bairro }},%20{{ pedido.endereco.numero }}%20{{ pedido.endereco.cidade }}%20-%20{{ pedido.endereco.estado }}%20(CEP:%20{{ pedido.endereco.cep }})%0A*Opção%20de%20Nota%20Fiscal:*%20{{ pedido.get_nota_fiscal_display }} ">Enviar Para Whatsapp</a>
            {% else %}
                <a href="{% url 'pedidos' %}" class="btn btn-secondary">Voltar para o Histórico</a>
                <a href="{% url 'exportar_pedido_cliente_excel' pedido.id %}" class="btn btn-primary ms-2">Exportar para Excel</a>
            {% endif %}
</div>
    </div>

    <hr>

  <!--  <div class="card mb-4">
        <div class="card-header">
            <h3>Encaminhe essa mensagem ao vendedor 22, junto da planilha </h3>
        </div>
       <div class="card-body">
                <p><strong>Codigo Interno:</strong> {{ pedido.id }}</p>
                <p><strong>Código do Cliente:</strong> {{ pedido.cliente.client_code }}</p>
                <p><strong>Razão Social:</strong> {{ pedido.cliente.client_name }}</p>
                <p><strong>Data da Expedição:</strong> {{ pedido.data_envio_solicitada|date:"d/m/Y" }}</p>
                <p><strong>Opção de Frete:</strong> {{ pedido.get_frete_option_display }}</p>
                <p><strong>Endereço de Entrega:</strong> {{ pedido.endereco.logradouro }}, {{ pedido.endereco.bairro }}, {{ pedido.endereco.numero }} {{ pedido.endereco.cidade }} - {{ pedido.endereco.estado }} (CEP: {{ pedido.endereco.cep }})</p>
                <p><strong>Opção de Nota Fiscal:</strong> {{ pedido.get_nota_fiscal_display }}</p>

        </div> -->
      
    </div>

{% endblock %}